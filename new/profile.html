<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>うちあけ - 統合版マイページ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&family=Klee+One&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f8fafc; }
        .font-klee-one { font-family: 'Klee One', cursive; }
        .post-card-icon { width: 1.25rem; height: 1.25rem; margin-right: 0.25rem; }
        .notification-bell::after { content: attr(data-count); position: absolute; top: -4px; right: -6px; width: 18px; height: 18px; background-color: #ef4444; color: white; border-radius: 50%; font-size: 11px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
        .feed-tab { transition: all 0.3s ease; border-bottom: 3px solid transparent; padding-bottom: 0.75rem; }
        .feed-tab.active { color: #f97316; border-bottom-color: #f97316; }
        .draft-card { background: linear-gradient(135deg, #fffbeb, #fef2f2); border: 2px dashed #fcd34d; }
        .profile-card { background-color: #fff; }
        .stat-item .stat-value { color: #f97316; }
        .mypage-sub-tab { transition: all 0.2s ease; border-bottom: 2px solid transparent; }
        .mypage-sub-tab.active { color: #ea580c; border-bottom-color: #ea580c; }
        .modal-overlay { opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out; position: fixed; inset: 0; z-index: 50; display: flex; align-items: center; justify-content: center; padding: 1rem; background-color: rgba(0,0,0,0.6); }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { transform: translateY(20px) scale(0.95); opacity: 0; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-in-out; max-height: 90vh; overflow-y: auto; background-color: white; border-radius: 1rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); }
        .modal-overlay.active .modal-content { transform: translateY(0) scale(1); opacity: 1; }
        .custom-checkbox:checked { background-color: #f97316; border-color: #f97316; }
        .custom-checkbox:checked + label { color: #f97316; font-weight: 600; }
        .fab-action { opacity: 0; transform: translateY(20px) scale(0.9); transition: all 0.2s ease-in-out; pointer-events: none; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .fab-action:hover { transform: scale(1.05) !important; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        #fab-container.active .fab-action { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
        #fab-toggle .fa-plus { transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        #fab-container.active #fab-toggle .fa-plus { transform: rotate(45deg); }
        .progress-bar { background-color: #e5e7eb; }
        .progress-bar-inner { background-color: #f97316; transition: width 0.5s ease-in-out; }
        .supporter-condition.completed .action-btn { background-color: #d1fae5; color: #065f46; cursor: default; }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">

    <header class="fixed top-0 w-full z-40 flex items-center justify-between px-4 py-2 bg-white shadow-md">
        <h1 class="flex justify-start text-xl font-bold">
        <a class="flex items-center text-gray-800" href="profile"><img alt="うちあけ ロゴ" class="rounded-full shadow-sm" height="40" src="https://placehold.co/40x40/FFDDC1/FF6B35?text=U" width="40" /><p class="ml-2 whitespace-nowrap text-orange-500 font-klee-one text-2xl">うちあけ</p></a></h1>
        <div class="grow"></div>
        <nav class="flex items-center gap-4 sm:gap-6"><a href="notification" class="relative text-gray-600 hover:text-orange-500 transition notification-bell" data-count="3" title="通知"><i class="fas fa-bell text-2xl"></i></a>
            <a href="profile" class="flex items-center gap-2 hover:opacity-80 transition" title="マイページ"><img src="https://placehold.co/40x40/a7f3d0/166534?text=A" alt="プロフィール画像" class="w-9 h-9 sm:w-10 sm:h-10 rounded-full border-2 border-orange-200"><span class="hidden sm:inline font-semibold text-gray-700">あなたさん</span></a></nav>
    </header>

    <main class="pt-[68px]">
        <section class="py-8 px-4"><div class="max-w-4xl mx-auto"><div class="draft-card rounded-xl p-6 text-center shadow-lg transition hover:shadow-xl"><div class="flex flex-col sm:flex-row items-center justify-center gap-4"><div class="text-yellow-500"><i class="fas fa-edit text-4xl"></i></div><div class="text-left"><h2 class="text-xl font-bold text-gray-800">書きかけの投稿があります</h2><p class="text-gray-600 mt-1">「ストレートネックによる頭痛」の続きを書きませんか？</p></div><a href="new/form" class="mt-3 sm:mt-0 sm:ml-auto w-full sm:w-auto shrink-0 bg-orange-500 text-white font-semibold py-3 px-6 rounded-full shadow hover:bg-orange-600 transition">続きを書く</a></div></div></div></section>
        <section class="my-8 sm:my-12 px-4 sm:px-6">
            <div class="flex justify-center border-b border-gray-200 mb-6 sm:mb-8">
                <button class="feed-tab active text-lg font-semibold py-3 px-4 sm:px-6 text-gray-500" data-tab="mypage"><i class="fas fa-user-circle mr-1 sm:mr-2"></i>マイページ</button>
                    <a href="community" class="feed-tab text-lg font-semibold py-3 px-4 sm:px-6 text-gray-500 hover:text-orange-500">
                    <i class="fas fa-users mr-1 sm:mr-2"></i>コミュニティ</a>
                <button class="feed-tab text-lg font-semibold py-3 px-4 sm:px-6 text-gray-500" data-tab="for-you"><i class="fas fa-user-check mr-1 sm:mr-2"></i>あなたへ</button><button class="feed-tab text-lg font-semibold py-3 px-4 sm:px-6 text-gray-500" data-tab="latest"><i class="fas fa-rss mr-1 sm:mr-2"></i>最新</button></div>
            <div id="feed-content-container" class="max-w-6xl mx-auto">
                <div id="mypage-content" class="main-tab-content"><div class="profile-card max-w-4xl mx-auto p-6 sm:p-8 rounded-xl shadow-lg mb-8 sm:mb-12"><div class="flex flex-col sm:flex-row items-center gap-6"><div class="relative shrink-0"><img src="https://placehold.co/120x120/a7f3d0/166534?text=A" alt="プロフィール画像" class="w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white shadow-md"><button class="absolute bottom-0 right-0 bg-white w-8 h-8 rounded-full flex items-center justify-center shadow-md hover:bg-gray-100 transition"><i class="fas fa-camera text-gray-600"></i></button></div><div class="text-center sm:text-left w-full"><div class="flex items-center justify-center sm:justify-start gap-4"><h2 class="text-2xl sm:text-3xl font-bold text-gray-800">あなたさん</h2><span id="mypage-supporter-badge" class="bg-amber-100 text-amber-800 text-xs font-bold px-3 py-1 rounded-full shadow-md hidden"><i class="fas fa-crown mr-1"></i>サポーター</span></div><p id="mypage-supporter-greeting" class="text-gray-600 text-sm mt-2 hidden">いつもご協力いただき、ありがとうございます！</p><p class="text-gray-600 mt-2">ここに自己紹介文が入ります。同じ悩みを持つ方と情報交換したいです。よろしくお願いします。</p><div class="mt-4 flex justify-center sm:justify-start gap-4"><div class="stat-item text-center"><p class="stat-value text-2xl font-bold">12</p><p class="text-xs text-gray-500">あなたの投稿</p></div><div class="stat-item text-center"><p class="stat-value text-2xl font-bold">158</p><p class="text-xs text-gray-500">もらった共感</p></div><div class="stat-item text-center"><p class="stat-value text-2xl font-bold">25</p><p class="text-xs text-gray-500">ブックマーク</p></div></div></div>
                <a href="profile-edit" class="shrink-0 mt-4 sm:mt-0 sm:ml-auto w-full sm:w-auto bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-full hover:bg-gray-300 transition"><i class="fas fa-cog mr-2"></i>設定</a></div></div>
                    <div id="supporter-info-link-section" class="max-w-4xl mx-auto mb-8 sm:mb-12"><div class="bg-gradient-to-r from-amber-100 to-orange-100 p-6 rounded-xl shadow-md transition hover:shadow-lg cursor-pointer" id="open-supporter-info-modal"><div class="flex flex-col sm:flex-row items-center gap-4 text-center sm:text-left"><div class="text-amber-500 text-4xl flex-shrink-0"><i class="fas fa-crown"></i></div><div class="flex-grow"><h3 class="font-bold text-lg text-gray-800">うちあけサポータープログラム</h3><p class="text-sm text-gray-600 mt-1">あなたの経験を、もっと未来の医療のために役立てませんか？サポーターについて詳しく見る</p></div><i class="fas fa-chevron-right text-gray-500 ml-auto hidden sm:block flex-shrink-0"></i></div></div></div>
                    <div id="supporter-benefits-section" class="max-w-4xl mx-auto mb-8 sm:mb-12 hidden"><h3 class="font-bold text-gray-700 mb-3 text-lg">サポーター特典</h3><div class="space-y-3"><div class="block bg-white p-4 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition-shadow"><div class="flex items-center gap-4"><i class="fas fa-chart-line text-2xl text-blue-500"></i><div><h4 class="font-semibold text-blue-800">Myペイシェントジャーニー</h4><p class="text-sm text-gray-600">あなたの感情の推移をAIが分析・可視化します。</p></div></div></div><div class="block bg-gray-100 p-4 rounded-lg shadow-inner border border-gray-200 opacity-70"><div class="flex items-center gap-4"><i class="fas fa-user-md text-2xl text-gray-400"></i><div><h4 class="font-semibold text-gray-500">専門家への優先質問権（準備中）</h4><p class="text-sm text-gray-500">薬剤師や専門家へ優先的に質問できます。</p></div></div></div></div></div>
                    <div class="flex justify-center border-b border-gray-200 mb-6"><button class="mypage-sub-tab active font-semibold py-2 px-5" data-subtab="my-posts">自分の投稿</button><button class="mypage-sub-tab font-semibold py-2 px-5" data-subtab="bookmarks">ブックマーク</button></div>
<div id="mypage-sub-content-container">
    <div id="my-posts-content" class="mypage-sub-content">
        <!-- 
          grid: グリッドレイアウトを適用
          grid-cols-1: デフォルト（モバイルサイズ）では1列表示
          md:grid-cols-2: mediumサイズ（768px）以上では2列表示
          gap-4: カード間の隙間を調整
        -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-2">
            
            <!-- 1つ目の投稿カード -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">ストレートネックによる頭痛</h3>
                <p class="text-xs text-gray-600 mb-3 line-clamp-3">時々、後頭部を金槌で殴られたような痛みに襲われます。原因はストレートネックでしたが、治療で症状は少しずつ落ち着いています。</p>
                <div class="flex items-center text-gray-500 text-xs mt-3 border-t pt-3">
                    <span class="flex items-center mr-3"><i class="post-card-icon fas fa-heart text-red-500"></i>45</span>
                    <span class="flex items-center"><i class="post-card-icon fas fa-comment text-blue-500"></i>8</span>
                    <a href="form-edit-talk" class="ml-auto text-xs bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full">編集</a>
                </div>
            </div>

            <!-- 2つ目の投稿カード -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">頭痛についての記録 2025/8/7</h3>
                <p class="text-xs text-gray-600 mb-3 line-clamp-3">・ロキソニンを1錠服用・午後は少し楽になった</p>
                <div class="flex items-center text-gray-500 text-xs mt-3 border-t pt-3">
                    <span class="flex items-center mr-3"><i class="post-card-icon fas fa-heart text-red-500"></i>3</span>
                    <span class="flex items-center"><i class="post-card-icon fas fa-comment text-blue-500"></i>2</span>
                    <a href="form-edit-journal" class="ml-auto text-xs bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full">編集</a>
                </div>
            </div>

            <!-- 3つ目の投稿カード -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h3 class="font-semibold text-gray-800 mb-2 line-clamp-2">私の関節リウマチ治療体験記</h3>
                <p class="text-xs text-gray-600 mb-3 line-clamp-3">生物学的製剤の自己注射と、痛み止めを処方されています。定期的にリハビリも行っています。</p>
                <div class="flex items-center text-gray-500 text-xs mt-3 border-t pt-3">
                    <span class="flex items-center mr-3"><i class="post-card-icon fas fa-heart text-red-500"></i>4</span>
                    <span class="flex items-center"><i class="post-card-icon fas fa-comment text-blue-500"></i>2</span>
                    <a href="form-edit-contribute" class="ml-auto text-xs bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full">編集</a>
                </div>
            </div>

        </div>
    </div>
</div>
                    <div class="max-w-4xl mx-auto mt-12"><div class="bg-white p-6 rounded-xl shadow-md border border-gray-200 cursor-pointer transition hover:shadow-lg" id="open-feedback-modal"><div class="flex items-center gap-4"><div class="text-blue-500 text-3xl"><i class="fas fa-lightbulb"></i></div><div><h3 class="font-bold text-gray-800">サービスを一緒に育てませんか？</h3><p class="text-sm text-gray-600 mt-1">より良いサービスのため、あなたの声をお聞かせください。（1分程度）</p></div></div></div></div>
                </div>
                <div id="for-you-content" class="main-tab-content hidden"><div class="text-center mb-6"><p id="interest-categories-text" class="text-gray-500 mb-3">あなたが関心のある「心・精神」「ストレス・睡眠」の投稿です。</p><button id="open-category-modal-btn" class="text-sm text-orange-600 font-semibold hover:text-orange-700 transition"><i class="fas fa-cog mr-1"></i>関心カテゴリを設定</button></div><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-2"><div class="bg-white rounded-lg shadow-md p-4 transition hover:shadow-lg transform hover:-translate-y-1"><h3 class="font-semibold text-base sm:text-lg text-gray-800 mb-2 line-clamp-2">不安な気持ちとの闘い</h3><p class="text-xs sm:text-sm text-gray-600 mb-3 line-clamp-3">「診断を受けてから、毎日が不安でいっぱいです。でも、ここで同じように頑張っている人の投稿を読んで、少しだけ心が軽くなりました。」</p><div class="flex flex-wrap items-center text-gray-500 text-xs mb-3 space-x-2"><span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs font-medium">心・精神</span></div><div class="flex items-center text-gray-500 text-xs mt-3"><span class="mr-3 flex items-center">2025/07/15</span><span class="flex items-center mr-3"><i class="post-card-icon fas fa-heart text-red-500"></i>120</span><span class="flex items-center"><i class="post-card-icon fas fa-comment text-blue-500"></i>35</span></div></div></div></div>
                <div id="latest-content" class="main-tab-content hidden"><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 p-2"><div class="bg-white rounded-lg shadow-md p-4 text-center">最新の投稿がここに表示されます。</div></div></div>
            </div>
        </section>
    </main>

    <div id="fab-container" class="fixed bottom-4 right-4 sm:bottom-6 sm:right-6 z-50 flex flex-col items-center gap-3">
        <button id="fab-back" class="fab-action flex h-12 w-12 sm:h-14 sm:w-14 items-center justify-center rounded-full bg-cyan-200 text-gray-800 shadow-lg"><svg class="size-5 sm:size-6" fill="none" stroke="currentColor" stroke-width="2.5" viewbox="0 0 24 24"><path d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" stroke-linecap="round" stroke-linejoin="round"></path></svg></button>
        <a href="search-user" class="fab-action flex h-12 sm:h-14 items-center justify-center rounded-full bg-amber-500 px-4 sm:px-5 text-sm font-semibold text-white shadow-lg"><span class="mr-2 hidden sm:inline">閲覧</span><i class="fas fa-eye text-lg"></i></a>
        <a href="new/form" class="fab-action flex h-12 sm:h-14 items-center justify-center rounded-full bg-emerald-500 px-4 sm:px-5 text-sm font-semibold text-white shadow-lg"><span class="mr-2 hidden sm:inline">投稿</span><i class="fas fa-pencil-alt text-lg"></i></a>
        <button id="fab-toggle" class="flex h-14 w-14 sm:h-16 sm:w-16 items-center justify-center rounded-full bg-orange-500 text-white shadow-lg transition-transform duration-300 ease-in-out hover:scale-110"><i class="fas fa-plus text-2xl"></i></button>
    </div>

    <footer class="mt-8 bg-gray-100 py-6 sm:py-8 text-gray-800">
        <div class="text-center text-xs sm:text-sm text-gray-500">&copy; 2025 うちあけ All rights reserved.</div>
    </footer>

    <div id="category-modal-container" class="modal-overlay">
        <div class="modal-content w-full max-w-3xl p-6 sm:p-8">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-2">関心のあるカテゴリを選択</h3>
            <p class="text-gray-600 text-sm mb-4">選択したカテゴリの投稿が「あなたへ」タブで優先的に表示されます。（複数選択可）</p>
            <div class="flex gap-4 mb-4 border-b pb-4">
                <button id="select-all-btn" class="text-sm bg-blue-100 text-blue-700 font-semibold py-1 px-3 rounded-full hover:bg-blue-200 transition">すべて選択</button>
                <button id="deselect-all-btn" class="text-sm bg-gray-100 text-gray-700 font-semibold py-1 px-3 rounded-full hover:bg-gray-200 transition">すべて選択解除</button>
            </div>
            <div id="category-checkbox-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 max-h-64 overflow-y-auto pr-2"></div>
            <div class="flex justify-end gap-4 mt-8">
                <button id="close-category-modal-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-5 rounded-full hover:bg-gray-300 transition">閉じる</button>
                <button id="save-categories-btn" class="bg-orange-500 text-white font-semibold py-2 px-5 rounded-full hover:bg-orange-600 transition">保存する</button>
            </div>
        </div>
    </div>
    
    <div id="supporter-info-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-2xl p-6 sm:p-8">
            <button id="close-supporter-info-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <div class="text-center"><i class="fas fa-crown text-4xl text-amber-400"></i><h2 class="text-2xl font-bold mt-4 text-gray-800">うちあけサポータープログラムについて</h2><p class="mt-2 text-gray-600">あなたの経験は、未来の医療にとっての貴重な財産です。</p></div>
            <div class="mt-8 space-y-6 text-left">
                <div><h3 class="font-bold text-lg text-gray-800">サポーターとは？</h3><p class="mt-1 text-sm text-gray-600">「うちあけサポーター」とは、ご自身の体験をより詳しく共有することで、同じ悩みを持つ方や未来の医療に積極的に貢献してくださるユーザーのことです。サポーターへの参加や活動は**すべて無料**です。</p></div>
                <div><h3 class="font-bold text-lg text-gray-800">サポーターになるには？</h3><p class="mt-1 text-sm text-gray-600 mb-4">うちあけでの活動を通じて、以下の条件を満たすと自動的にサポーターとして認定されます。</p><div id="supporter-conditions-list" class="space-y-4"></div></div>
                <div><h3 class="font-bold text-lg text-gray-800">サポーターの特典</h3><p class="mt-1 text-sm text-gray-600">ご協力への感謝として、特別な機能をご利用いただけます。</p><div class="mt-3 space-y-2"><div class="block bg-blue-50 p-3 rounded-lg"><div class="flex items-center gap-3"><i class="fas fa-chart-line text-xl text-blue-500"></i><div><h4 class="font-semibold text-blue-800 text-sm">Myペイシェントジャーニー</h4></div></div></div><div class="block bg-gray-100 p-3 rounded-lg opacity-70"><div class="flex items-center gap-3"><i class="fas fa-user-md text-xl text-gray-400"></i><div><h4 class="font-semibold text-gray-500 text-sm">専門家への優先質問権（準備中）</h4></div></div></div></div></div>
            </div>
        </div>
    </div>
    
    <div id="feedback-modal" class="modal-overlay">
        <div class="modal-content w-full max-w-lg p-6 sm:p-8">
            <button id="close-feedback-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
            <form id="feedback-form-content"><div class="text-center"><i class="fas fa-lightbulb text-4xl text-blue-500"></i><h2 class="text-2xl font-bold mt-4 text-gray-800">サービスを一緒に育てませんか？</h2><p class="mt-2 text-gray-600 text-sm leading-relaxed">「うちあけ」は始まったばかりのサービスです。皆さんと一緒に、もっと使いやすく、もっと心安らぐ場所にしていきたいと思っています。<br><span class="font-bold mt-2 inline-block">このアンケートは匿名で送信され、個人が特定されることはありませんので、どうぞ率直なご意見をお聞かせください。</span></p></div><div class="mt-8 space-y-6 text-left"><div><label class="block text-sm font-bold text-gray-700 mb-2">特に改善してほしい点はどこですか？（複数選択可）</label><div class="space-y-2 text-sm"><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">デザイン・見た目</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">投稿・記録のしやすさ</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">投稿の探しやすさ（検索機能）</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">マイページ機能</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">サポーター制度について</label><label class="flex items-center"><input type="checkbox" class="h-4 w-4 rounded border-gray-300 text-orange-500 focus:ring-orange-500 mr-2">その他</label></div></div><div><label for="feedback-textarea" class="block text-sm font-bold text-gray-700 mb-2">「こんな機能がほしい」「ここが使いにくい」など、ご意見を自由にお聞かせください。</label><textarea id="feedback-textarea" rows="4" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-400" placeholder="例：自分の投稿に画像を追加できるようにしてほしい"></textarea></div></div><div class="mt-8 text-center"><button id="submit-feedback-btn" type="submit" class="w-full btn-primary font-bold py-3 px-6 rounded-full transition shadow-md">ご意見を送る</button></div></form>
            <div id="feedback-thanks-content" class="text-center hidden"><div class="text-5xl mb-4">💌</div><h2 class="text-2xl font-bold mt-4 text-gray-800">ご協力ありがとうございました！</h2><p class="mt-2 text-gray-600 text-sm leading-relaxed">いただいた貴重なご意見は、今後のサービス改善の参考にさせていただきます。</p><div class="mt-8 text-center"><button id="close-thanks-btn" class="w-full btn-secondary font-bold py-3 px-6 rounded-full transition">閉じる</button></div></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const state = {
                isSupporter: false, 
                supporterProgress: { 
                    register: 1, setCategory: 0, viewPost: 5,
                    giveEmpathy: 2, contributePost: 0, giveFeedback: 0,
                }
            };
            const supporterGoals = {
                register: 1, setCategory: 1, viewPost: 10,
                giveEmpathy: 5, contributePost: 1, giveFeedback: 1,
            };
            const supporterConditions = [
                { id: 'register', text: 'アカウント登録をする', icon: 'fa-user-check', actionText: '達成済み', actionTarget: null },
                { id: 'setCategory', text: '興味のあるカテゴリを設定する', icon: 'fa-tags', actionText: '設定する', actionTarget: 'category-modal' },
                { id: 'viewPost', text: '他の方のうちあけを見る', icon: 'fa-eye', actionText: '見にいく', actionTarget: 'latest' },
                { id: 'giveEmpathy', text: '他の方のうちあけに共感ボタンを押す', icon: 'fa-heart', actionText: '共感しにいく', actionTarget: 'latest' },
                { id: 'contributePost', text: '「経験を役立てる」投稿をする', icon: 'fa-hand-holding-heart', actionText: '投稿する', actionTarget: 'screen-category-selection' },
                { id: 'giveFeedback', text: 'サービス改善のお声をいただく', icon: 'fa-lightbulb', actionText: '意見を送る', actionTarget: 'feedback-modal' }
            ];
            const categories = ['頭・脳・神経','耳鼻・口・目','手足・肩・腰','心臓・肺・気道','血管・血液','胃・食道・腸','肝臓・膵臓・胆嚢','腎臓・尿路・尻','皮膚・肌・髪','骨・関節・筋肉','ストレス・睡眠','ホルモン・代謝','心・精神','感染症','がん','生活習慣病','免疫疾患','遺伝子疾患','男性に多い疾患','女性に多い疾患','子供に多い疾患','その他'];

            const supporterBadge = document.getElementById('mypage-supporter-badge');
            const supporterGreeting = document.getElementById('mypage-supporter-greeting');
            const supporterInfoLink = document.getElementById('supporter-info-link-section');
            const supporterBenefits = document.getElementById('supporter-benefits-section');
            if (state.isSupporter) {
                if(supporterBadge) supporterBadge.classList.remove('hidden');
                if(supporterGreeting) supporterGreeting.classList.remove('hidden');
                if(supporterInfoLink) supporterInfoLink.style.display = 'none'; 
                if(supporterBenefits) supporterBenefits.classList.remove('hidden');
            } else {
                if(supporterBadge) supporterBadge.classList.add('hidden');
                if(supporterGreeting) supporterGreeting.classList.add('hidden');
                if(supporterInfoLink) supporterInfoLink.style.display = 'block';
                if(supporterBenefits) supporterBenefits.classList.add('hidden');
            }

            const supporterModal = document.getElementById('supporter-info-modal');
            const openSupporterModalBtn = document.getElementById('open-supporter-info-modal');
            const closeSupporterModalBtn = document.getElementById('close-supporter-info-modal');
            const supporterConditionsList = document.getElementById('supporter-conditions-list');
            const feedbackModal = document.getElementById('feedback-modal');
            const categoryModalContainer = document.getElementById('category-modal-container');
            const openCategoryModalBtn = document.getElementById('open-category-modal-btn');

            const openSupporterModal = () => {
                supporterConditionsList.innerHTML = ''; 
                supporterConditions.forEach(cond => {
                    const current = state.supporterProgress[cond.id] || 0;
                    const goal = supporterGoals[cond.id];
                    const isCompleted = current >= goal;
                    const progressPercent = Math.min((current / goal) * 100, 100);
                    const completedClass = isCompleted ? 'completed' : '';
                    const actionButtonHTML = isCompleted 
                        ? `<button class="action-btn text-sm font-bold py-2 px-4 rounded-full transition" disabled><i class="fas fa-check-circle mr-2"></i>達成済み</button>`
                        : `<button class="action-btn text-sm font-bold bg-orange-100 text-orange-700 hover:bg-orange-200 py-2 px-4 rounded-full transition" data-action-target="${cond.actionTarget}">${cond.actionText}</button>`;

                    const conditionHTML = `<div class="supporter-condition bg-gray-50 p-4 rounded-lg ${completedClass}"><div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2"><p class="text-sm font-semibold text-gray-800 w-full sm:w-auto"><i class="fas ${cond.icon} fa-fw mr-2 text-gray-500"></i>${cond.text}</p><div class="w-full sm:w-auto flex-shrink-0 mt-2 sm:mt-0">${actionButtonHTML}</div></div>${!isCompleted ? `<div class="flex justify-between items-center text-xs text-gray-500 mt-2"><div class="progress-bar w-full rounded-full h-1.5 flex-1 mr-2"><div class="progress-bar-inner rounded-full h-1.5" style="width: ${progressPercent}%"></div></div><p class="font-medium whitespace-nowrap">あと ${goal - current} 回</p></div>` : ''}</div>`;
                    supporterConditionsList.innerHTML += conditionHTML;
                });
                
                supporterConditionsList.querySelectorAll('.action-btn[data-action-target]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const target = e.currentTarget.dataset.actionTarget;
                        closeSupporterModal();
                        if (target === 'latest') {
                            document.querySelector('.feed-tab[data-tab="latest"]').click();
                        } else if (target === 'feedback-modal') {
                            openFeedbackModal();
                        } else if (target === 'category-modal') {
                            openCategoryModal();
                        } else if (target === 'screen-category-selection') {
                            alert('投稿ページへ遷移します');
                        }
                    });
                });

                supporterModal.classList.add('active');
            };
            const closeSupporterModal = () => supporterModal.classList.remove('active');
            if(openSupporterModalBtn) openSupporterModalBtn.addEventListener('click', openSupporterModal);
            if(closeSupporterModalBtn) closeSupporterModalBtn.addEventListener('click', closeSupporterModal);
            if(supporterModal) supporterModal.addEventListener('click', (e) => { if (e.target === supporterModal) closeSupporterModal(); });

            const openFeedbackModalBtn = document.getElementById('open-feedback-modal');
            const closeFeedbackModalBtn = document.getElementById('close-feedback-modal');
            const feedbackForm = document.getElementById('feedback-form-content');
            const feedbackThanks = document.getElementById('feedback-thanks-content');
            const closeThanksBtn = document.getElementById('close-thanks-btn');
            const openFeedbackModal = () => feedbackModal.classList.add('active');
            const closeFeedbackModal = () => {
                feedbackModal.classList.remove('active');
                setTimeout(() => {
                    if(feedbackForm) feedbackForm.classList.remove('hidden');
                    if(feedbackThanks) feedbackThanks.classList.add('hidden');
                    feedbackModal.querySelector('form')?.reset();
                }, 300);
            };
            if(openFeedbackModalBtn) openFeedbackModalBtn.addEventListener('click', openFeedbackModal);
            if(closeFeedbackModalBtn) closeFeedbackModalBtn.addEventListener('click', closeFeedbackModal);
            if(closeThanksBtn) closeThanksBtn.addEventListener('click', closeFeedbackModal);
            if(feedbackModal) feedbackModal.addEventListener('click', (e) => { if (e.target === feedbackModal) closeFeedbackModal(); });
            if(feedbackForm) feedbackForm.addEventListener('submit', (e) => {
                 e.preventDefault();
                 feedbackForm.classList.add('hidden');
                 feedbackThanks.classList.remove('hidden');
                 state.supporterProgress.giveFeedback = 1;
            });
            
            const fabToggle = document.getElementById('fab-toggle');
            const fabContainer = document.getElementById('fab-container');
            if (fabToggle && fabContainer) {
                fabToggle.addEventListener('click', () => { fabContainer.classList.toggle('active'); });
            }
            document.getElementById('fab-back')?.addEventListener('click', () => { window.history.back(); });

            const mainTabs = document.querySelectorAll('.feed-tab');
            const mainTabContents = document.querySelectorAll('.main-tab-content');
            mainTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    mainTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const targetContentId = tab.dataset.tab + '-content';
                    mainTabContents.forEach(content => {
                        content.classList.add('hidden');
                        if (content.id === targetContentId) { content.classList.remove('hidden'); }
                    });
                });
            });

            const mypageSubTabs = document.querySelectorAll('.mypage-sub-tab');
            const mypageSubContents = document.querySelectorAll('.mypage-sub-content');
            mypageSubTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    mypageSubTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const targetContentId = tab.dataset.subtab + '-content';
                    mypageSubContents.forEach(content => {
                        content.classList.add('hidden');
                        if (content.id === targetContentId) { content.classList.remove('hidden'); }
                    });
                });
            });

            const closeCategoryModalBtn = document.getElementById('close-category-modal-btn');
            const saveBtn = document.getElementById('save-categories-btn');
            const categoriesText = document.getElementById('interest-categories-text');
            const checkboxGrid = document.getElementById('category-checkbox-grid');
            const selectAllBtn = document.getElementById('select-all-btn');
            const deselectAllBtn = document.getElementById('deselect-all-btn');
            
            const openCategoryModal = () => {
                categoryModalContainer.classList.add('active');
                document.body.style.overflow = 'hidden';
            };
            const closeCategoryModal = () => {
                categoryModalContainer.classList.remove('active');
                document.body.style.overflow = '';
            };
            const saveCategories = () => {
                const checkedCheckboxes = checkboxGrid.querySelectorAll('input[type="checkbox"]:checked');
                const selectedCategories = Array.from(checkedCheckboxes).map(cb => `「${cb.value}」`);
                if (categoriesText) {
                    categoriesText.textContent = selectedCategories.length > 0 ? `あなたが関心のある${selectedCategories.join('、')}の投稿です。` : '関心のあるカテゴリを設定すると、あなたへのおすすめ投稿が表示されます。';
                }
                closeCategoryModal();
            };

            checkboxGrid.innerHTML = categories.map((cat, index) => {
                const id = `cat-${index + 1}`;
                const isChecked = (cat === '心・精神' || cat === 'ストレス・睡眠') ? 'checked' : '';
                return `<div class="flex items-center"><input id="${id}" type="checkbox" class="custom-checkbox w-5 h-5 mr-2 rounded" value="${cat}" ${isChecked}><label for="${id}" class="text-gray-700 cursor-pointer">${cat}</label></div>`;
            }).join('');

            if (selectAllBtn) {
                selectAllBtn.addEventListener('click', () => {
                    checkboxGrid.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = true);
                });
            }
            if (deselectAllBtn) {
                deselectAllBtn.addEventListener('click', () => {
                    checkboxGrid.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
                });
            }

            if(openCategoryModalBtn) openCategoryModalBtn.addEventListener('click', openCategoryModal);
            if(closeCategoryModalBtn) closeCategoryModalBtn.addEventListener('click', closeCategoryModal);
            if(categoryModalContainer) categoryModalContainer.addEventListener('click', (e) => { if(e.target === categoryModalContainer) closeCategoryModal(); });
            if(saveBtn) saveBtn.addEventListener('click', saveCategories);
        });
    </script>
</body>
</html>